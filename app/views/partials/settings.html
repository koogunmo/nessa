<div id="settings">
	<form ng-submit="save()">
		<tabset>
			<tab heading="General">
				<div class="panel panel-info">
					<div class="panel-heading">
						<h4 class="panel-title">Server</h4>
					</div>
					<div class="panel-body">
						<div class="form-group">
							<label for="ipt_listen_address">Server Address</label>
							<input type="text" id="ipt_listen_address" name="listen:address" class="form-control" placeholder="0.0.0.0" required="true" ng-model="settings.listen.address" />
						</div>
						<div class="form-group">
							<label for="ipt_listen_port">Server Port</label>
							<input type="text" id="ipt_listen_port" name="listen:port" class="form-control" placeholder="6377" required="true" ng-model="settings.listen.port" />
						</div>
						<div class="form-group">
							<label class="checkbox-inline">
								<input type="checkbox" id="ipt_listen_nginx" name="listen:nginx" ng-model="settings.listen.nginx" />
								<strong>Use nginx</strong>
							</label>
						</div>
						<p>Changing these values will require restarting NodeTV</p>
					</div>
				</div>
				<div class="panel panel-info">
					<div class="panel-heading">
						<h4 class="panel-title">Media</h4>
					</div>
					<div class="panel-body">
						<div class="form-group">
							<label for="ipt_media_base">Base Media Directory</label>
							<div class="input-group">
								<input type="text" id="ipt_media_base" name="media:base" class="form-control" required="true" ng-model="settings.media.base" />
								<span class="input-group-addon">
									<span class="glyphicon glyphicon-folder-open"></span>
								</span>
							</div>
						</div>
						
						<div class="form-group">
							<label for="ipt_shows_base">Show Subdirectory</label>
							<div class="input-group">
								<span class="input-group-addon">{{settings.media.base}}</span>
								<input type="text" id="ipt_shows_base" name="shows:media:directory" class="form-control" required="true" ng-model="settings.media.shows.directory" />
							</div>
						</div>
						<div class="form-group">
							<label for="ipt_movies_base">Movie Subdirectory</label>
							<div class="input-group">
								<span class="input-group-addon">{{settings.media.base}}</span>
								<input type="text" id="ipt_movies_base" name="media:movies:directory" class="form-control" required="true" ng-model="settings.media.movies.directory" />
							</div>
						</div>
						<div class="form-group">
							<label class="checkbox-inline">
								<input type="checkbox" id="ipt_media_hd" name="media:hd" ng-model="settings.media.hd" />
								<strong>Prefer HD Videos</strong>
							</label>
						</div>
					</div>
				</div>
				<div class="panel panel-info">
					<div class="panel-heading">
						<h4 class="panel-title">Database <small>MongoDB</small></h4>
					</div>
					<div class="panel-body">
						<div class="form-group">
							<label for="">Host</label><input type="text" class="form-control" placeholder="127.0.0.1" required="true" ng-model="settings.mongo.host" />
						</div>
						<div class="form-group">
							<label for="">Port</label><input type="text" class="form-control" placeholder="27017" required="true" ng-model="settings.mongo.port" />
						</div>
						
						<div class="form-group">
							<label><input type="checkbox" ng-model="settings.mongo.auth" /> My database requires a username and password</label>
						</div>
						
						<div class="form-group" ng-if="settings.mongo.auth">
							<label for="">Username</label><input type="text" class="form-control" required="true" ng-model="settings.mongo.username" />
						</div>
						<div class="form-group" ng-if="settings.mongo.auth">
							<label for="">Password</label><input type="password" class="form-control" required="true" ng-model="settings.mongo.password" />
						</div>
					</div>
				</div>
				<div class="panel panel-info">
					<div class="panel-heading">
						<h4 class="panel-title">Transmission</h4>
					</div>
					<div class="panel-body">
						<div class="form-group">
							<label for="ipt_bt_host">Host</label>
							<input type="text" id="ipt_bt_host" name="transmission:host" class="form-control" required="true" ng-model="settings.transmission.host" />
						</div>
						<div class="form-group">
							<label for="ipt_bt_port">Port</label>
							<input type="text" for="ipt_bt_port" name="transmission:port" class="form-control" required="true" ng-model="settings.transmission.port" />
						</div>
						<div class="form-group">
							<label><input type="checkbox" ng-model="settings.transmission.auth" /> Transmission requires a username and password</label>
						</div>
						<div class="form-group" ng-if="settings.transmission.auth">
							<label for="ipt_bt_username">Username</label>
							<input type="text" id="ipt_bt_username" name="transmission:username" class="form-control" required="true" ng-model="settings.transmission.username" />
						</div>
						<div class="form-group" ng-if="settings.transmission.auth">
							<label for="ipt_bt_password">Password</label>
							<input type="password" id="ipt_bt_password" name="transmission:password" class="form-control" required="true" ng-model="settings.transmission.password" />
						</div>
					</div>
				</div>
				<div class="panel panel-info">
					<div class="panel-heading">
						<h4 class="panel-title">Trakt</h4>
					</div>
					<div class="panel-body">
						<div class="form-group">
							<label class="checkbox-inline">
								<input type="checkbox" id="ipt_trakt_enable" name="trakt:enabled" required="true" ng-model="settings.trakt.enabled" />
								<strong>Enable Integration</strong>
							</label>
						</div>
						<div ng-switch on="settings.trakt.enabled">
							<div class="alert alert-danger" ng-switch-when="false"><strong>Note</strong>: Trakt integration is <strong>required</strong></div>
							<div class="form-group" ng-switch-when="true">
								<label for="ipt_trakt_username">Username</label>
								<input type="text" id="ipt_trakt_username" name="trakt:username" class="form-control" required="true" ng-model="settings.trakt.username" />
							</div>
							<div class="form-group" ng-switch-when="true">
								<label for="ipt_trakt_password">Password</label>
								<input type="password" id="ipt_trakt_password" name="trakt:password" class="form-control" required="true" ng-model="settings.trakt.password" />
							</div>
							<div class="form-group" ng-switch-when="true">
								<label for="ipt_trakt_api">API Key</label>
								<input type="text" id="ipt_trakt_api" name="trakt:apikey" class="form-control" required="true" ng-model="settings.trakt.apikey" />
							</div>
						</div>
					</div>
				</div>
				<div class="panel panel-info">
					<div class="panel-heading">
						<h4 class="panel-title">Twilio</h4>
					</div>
					<div class="panel-body">
						<div class="form-group">
							<label class="checkbox-inline">
								<input type="checkbox" id="ipt_twilio_enabled" name="twilio:enabled" ng-model="settings.twilio.enabled" />
								<strong>Enable SMS Notifications</strong>
							</label>
						</div>
						<div ng-switch on="settings.twilio.enabled">
							<div class="alert alert-warning" ng-switch-when="false"><strong>Note</strong>: SMS integration is not yet functional</div>
							<div class="form-group" ng-switch-when="true">
								<label for="ipt_twilio_phone">Phone</label>
								<input type="text" id="ipt_twilio_phone" name="twilio:phone" ng-model="settings.twilio.phone" />
							</div>
							<div class="form-group" ng-switch-when="true">
								<label for="ipt_twilio_sid">SID</label>
								<input type="text" id="ipt_twilio_sid" name="twilio:sid" class="form-control" required="true" ng-model="settings.twilio.sid" />
							</div>
							<div class="form-group" ng-switch-when="true">
								<label for="ipt_twilio_token">Token</label>
								<input type="text" id="ipt_twilio_token" name="twilio:token" class="form-control" required="true" ng-model="settings.twilio.token" />
							</div>
						</div>
					</div>
				</div>
			</tab>
			<tab heading="Security">
				<div class="panel panel-info" >
					<div class="panel-heading">
						<h4 class="panel-title">Users</h4>
					</div>
					
					<div class="panel-body">
						<table class="table table-stripe table-hover">
							<thead>
								<tr>
									<th class="col-sm-3">Username</th>
									<th class="col-sm-8">Privileges</th>
									<th class="col-sm-1">&nbsp;</th>
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="user in users">
									<td>{{user.username}}</td>
									<td>
										<span ng-repeat="role in user.roles">{{role}}</span>
									</td>
									<td align="right">
										<button type="button" class="btn btn-xs btn-warning" ng-click="userEdit(user._id)"><span class="glyphicon glyphicon-edit"></span></button>
										<button type="button" class="btn btn-xs btn-danger" ng-click="userRemove(user._id)"><span class="glyphicon glyphicon-trash"></span></button>
									</td>
								</tr>
							</tbody>
						</table>
						<button type="button" class="btn btn-success" ng-click="userEdit()"><span class="glyphicon glyphicon-plus"></span> Add User</button>
					</div>
				</div>
				<div class="panel panel-info">
					<div class="panel-heading">
						<h4 class="panel-title">Network Security</h4>
					</div>
					<div class="panel-body">
						<div class="form-group">
							<label for="ipt_security_whitelist">IP Whitelist</label>
							<input type="text" id="ipt_security_whitelist" name="security:whitelist" ng-model="settings.security.whitelist" class="form-control" />
						</div>
						<div class="well">
							Users from the allowed IP ranges will not be required to log in.
						</div>
					</div>
				</div>
			</tab>
			<tab heading="System">
				<div class="panel panel-warning">
					<div class="panel-heading">
						<h4 class="panel-title">Library Maintenance</h4>
					</div>
					<div class="panel-body">
						<div class="form-group">
							<button type="button" class="btn btn-info" ng-click="listings()">Update listings</button>
							<button type="button" class="btn btn-primary" ng-click="rescan()">Rescan Media</button>
						</div>
						<div class="well well-sm">NodeTV automatically updates show listings at 1am every Sunday.</div>
						<div class="form-group">
							<button type="button" class="btn btn-info" ng-click="latest()">Check for downloads</button>
						</div>
						<div class="well well-sm">NodeTV automatically checks for new downloads every 30 minutes.</div>
					</div>
				</div>
				<div class="panel panel-danger">
					<div class="panel-heading">
						<h4 class="panel-title">System Maintenance</h4>
					</div>
					<div class="panel-body">
						<div class="form-group">
							<label for="ipt_system_branch">Update channel</label>
							{{settings.system.derp}}
							<select name="system:branch" id="ipt_system_branch" ng-model="settings.system.branch" ng-options="branch.name as branch.name for branch in branches" class="form-control"></select>
						</div>
						<div class="form-group">
							<button type="button" class="btn btn-warning" ng-click="update()">Update</button>
							<button type="button" class="btn btn-danger" ng-click="reboot()">Restart</button>
						</div>
						<br />
						<div class="well well-sm">NodeTV checks for system updates at 3am every night, and automatically installs if available.</div>
					</div>
				</div>
			</tab>
		</tabset>
		<div class="toolbar">
			<button type="submit" class="btn btn-success">Save settings</button>
		</div>
	</form>
</div>